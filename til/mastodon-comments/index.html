<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Personal website of Roman BÃ¶hm. Includes blog posts, shorter 'Today I learned' posts, and various personal information."><meta name=viewport content="width=device-width,initial-scale=1"><link href=/css/stylesheet.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js integrity="sha512-KqUc2WMPF/gxte9xVjVE4TIt1LMUTidO3BrcItFg0Ro24I7pGNzgcXdnWdezNY+8T0/JEmdC79MuwYn+8UdOqw==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=/js/mastodon-comments.js></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><title>Roman BÃ¶hm - Use Mastodon as a Comment System</title></head><body><h1>Roman BÃ¶hm</h1><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/til/>TIL</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=/index.xml><img src=/images/rss.svg alt="RSS icon" width=14em></a></li></ul></nav><hr><h1>Use Mastodon as a Comment System</h1><h2>2023-09-23</h2><b><a href=/tags/hugo>hugo</a></b>
<b><a href=/tags/blogmeta>blogmeta</a></b>
<b><a href=/tags/mastodon>mastodon</a></b>
<b><a href=/tags/html>html</a></b>
<b><a href=/tags/javascript>javascript</a></b><aside><nav id=TableOfContents><ul><li><a href=#problem>Problem</a></li><li><a href=#solution>Solution</a><ul><li><a href=#providing-the-supporting-scripts>Providing the Supporting Scripts</a></li><li><a href=#embedding-the-component>Embedding the Component</a></li><li><a href=#providing-the-configuration>Providing the Configuration</a></li></ul></li><li><a href=#how-it-works>How It Works</a></li></ul></nav></aside><h2 id=problem>Problem</h2><p>I wanted to have a comment system for the posts in this blog. Not because I think there&rsquo;s demand for it, but because I can. ðŸ˜Ž</p><h2 id=solution>Solution</h2><p>The first thing which came to my mind was abusing Mastodon&rsquo;s <em>toot</em> system for my comment system. And of course, I (luckily) wasn&rsquo;t the first person to have that idea. Daniel Pecos provided both a <a href=https://danielpecos.com/2022/12/25/mastodon-as-comment-system-for-your-static-blog/>detailed instructional post</a> as well as <a href=https://github.com/dpecos/mastodon-comments>webcomponent</a> to embed Mastodon discussion on one&rsquo;s site.</p><p>Going from there was quite easy, fortunately:</p><h3 id=providing-the-supporting-scripts>Providing the Supporting Scripts</h3><p>In order to pull in the JavaScript supporting Daniel&rsquo;s webcomponent, I adjusted my site&rsquo;s <code>&lt;head></code> <em>partial</em>:</p><p>In layouts/partials/head.html:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>...
</span></span><span style=display:flex><span>{{ with .Params.tootId }}
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js&#34;</span> <span style=color:#a6e22e>integrity</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sha512-uHOKtSfJWScGmyyFr2O2+efpDx2nhwHU2v7MVeptzZoiC7bdF6Ny/CmZhN2AwIK1oCFiVQQ5DA/L9FSzyPNu6Q==&#34;</span> <span style=color:#a6e22e>crossorigin</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;anonymous&#34;</span> <span style=color:#a6e22e>referrerpolicy</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no-referrer&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/js/mastodon-comments.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css&#34;</span>&gt;
</span></span><span style=display:flex><span>{{ end }}
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>mastodon-comments.js is Daniel&rsquo;s <a href=https://github.com/dpecos/mastodon-comments/blob/master/mastodon-comments.js>script</a>, which resides in my static/js folder, i.e. it&rsquo;s not subject to any mangling by the blog engine and will be served just like that, as an asset.
I modified it ever so slighty in that I moved the following code from the webcomponent&rsquo;s constructor into the <code>connectedCallback</code> function, else it wouldn&rsquo;t work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>host</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;host&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;user&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tootId</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;tootId&#34;</span>);
</span></span></code></pre></div><p>Mind you, I have no idea of webcomponents, this was just <a href=https://stackoverflow.com/a/70201467>the first thing I found when searching the web</a>, and it worked.</p><p>Additionally, I made all scripts required for the comment system conditional so that they will only be loaded if the page you&rsquo;re on has a <code>tootId</code> param in the <a href=https://gohugo.io/content-management/front-matter/><em>front matter</em></a>.</p><h3 id=embedding-the-component>Embedding the Component</h3><p>layouts/posts/single.html and layouts/til/single.html both received this addition to make the comment section appear between content and footer:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>...
</span></span><span style=display:flex><span>{{ .Content }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{ with .Params.tootId }}
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>mastodon-comments</span> <span style=color:#a6e22e>host</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{ site.Params.mastodonHost }}&#34;</span> <span style=color:#a6e22e>user</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{ site.Params.mastodonUser }}&#34;</span> <span style=color:#a6e22e>tootId</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{ . }}&#34;</span>&gt;&lt;/<span style=color:#f92672>mastodon-comments</span>&gt;
</span></span><span style=display:flex><span>{{ end }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{ end }}
</span></span></code></pre></div><p>Again, a conditional include since I only want to provide a comment section where I&rsquo;ve prepared one (see explanation below). In that case, I&rsquo;ll add a <code>tootId</code> param to the front matter like mentioned above.</p><h3 id=providing-the-configuration>Providing the Configuration</h3><p>In config.yaml, I then added the values for <code>mastodonHost</code> and <code>mastodonUser</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>params</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mastodonHost</span>: <span style=color:#e6db74>&#34;mastodon.social&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mastodonUser</span>: <span style=color:#e6db74>&#34;romanboehm&#34;</span>
</span></span></code></pre></div><h2 id=how-it-works>How It Works</h2><p>In case the post in question hasn&rsquo;t been published yet:</p><ol><li>Prepare the post.</li><li>Just before publishing, create the accompanying Mastodon toot, and copy its id from the URL.</li><li>Provide <code>tootId: "&lt;designated-comment-toot's-id></code> in the post&rsquo;s front matter.</li><li>Publish the post. (In my case commit and push.)</li></ol><p>If I want to enable comments for an existing post:</p><ol><li>Create the accompanying Mastodon toot and copy its id from the URL.</li><li>Provide <code>tootId: "&lt;designated-comment-toot's-id></code> in the post&rsquo;s front matter.</li><li>Re-publish the post.</li></ol><mastodon-comments host=mastodon.social user=romanboehm tootid=111115895910218624></mastodon-comments><hr>Â© Roman BÃ¶hm 2021 - 2023 &ndash; <a href=https://github.com/romanboehm>Github</a> &ndash;
<a rel=me href=https://mastodon.social/@romanboehm>Mastodon</a> &ndash; <a href=https://www.linkedin.com/in/%F0%9F%96%A5%EF%B8%8F-roman-b%C3%B6hm-837946175/>LinkedIn</a></body></html>